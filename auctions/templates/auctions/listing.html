{% extends "auctions/layout.html" %}
<!--  -->
{% block body %}

<!-- # update page for winner context (i.e. closed auction)  -->
<!-- # add 'you won' if user == winner -->

<article class="listing">
    <!-- end auction -->
    {% if listing.user == request.user and listing.active %}
    <form action="{% url 'listing' listing.id %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="end" />
        <button type="submit">End auction?</button>
    </form>
    {% endif %}

    <!-- title, user, current price -->
    <br />
    <h4>{{ listing.title }}</h4>
    <p>Category: {{ listing.category }}</p>
    <p>Listed by: {{ listing.user }}</p>
    <p>Current bid: <strong> ${{ listing.current_bid }}</strong></p>

    <!-- signed in user -->
    <hr />
    {% if user.is_authenticated and listing.active %}
    <!-- watchlist -->
    <form action="{% url 'watchlist' %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="listing" value="{{ listing.id }}" />
        <button type="submit">{% if check_watchlist %} Remove from Watchlist {% else %} Add to Watchlist {% endif %}</button>
    </form>
    <!-- bid -->
    <form action="{% url 'listing' listing.id %}" method="post">
        {% csrf_token %}
        <button type="submit">Add Bid</button>
        <input type="number" name="bid" step="0.01" value="0.00" placeholder="$0.00" />
        <input type="hidden" name="user" value="{{ request.user.id }}" />
    </form>
    {% if error_message %}
    <p style="color: red">{{ error_message }}</p>
    {% endif %} {% endif %}

    <!-- listing over -->
    {% if not listing.active %}
    <p>This listing is finished.</p>
    {% if request.user == listing.winner %}
    <p>You won this auction!</p>
    {% endif %}
    <hr />
    {% endif %}

    <!-- description -->
    <br />
    <h4>Description</h4>
    <p>{{ listing.description }}</p>

    {% if listing.image %}
    <img src="{{ listing.image }}" alt="" />
    {% endif %}

    <!-- comment section -->
    <div>
        <h4>Comments:</h4>
        <ul class="comments">
            <!-- loop of comments -->
            {% for comment in comments %}
            <li><strong>{{ comment.user}} </strong>: {{ comment.comment }}</li>
            {% endfor %}
        </ul>
    </div>
    {% if user.is_authenticated %}
    <form action="{% url 'listing' listing.id %}" method="post">
        {% csrf_token %}
        <input type="text" name="comment" />
        <button type="submit">Add comment</button>
    </form>
    {% endif %}
</article>
<!--  -->

{% endblock %}
